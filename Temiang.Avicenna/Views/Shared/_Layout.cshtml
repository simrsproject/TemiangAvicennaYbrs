<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>@ViewData["Title"]</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="@(ViewBag.UrlRoot)/Bootstrap/plugins/fontawesome-free-5.13/css/all.min.css" />
    <!-- Ionicons -->
    <!-- <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    Theme style -->
    <link rel="stylesheet" href="@(ViewBag.UrlRoot)/Bootstrap/adminlte/css/adminlte.min.css" />
    <!-- JQuery UI -->
    <link rel="stylesheet" href="@(ViewBag.UrlRoot)/Bootstrap/plugins/jquery-ui/jquery-ui.min.css" />
    <!-- iCheck -->
    <link rel="stylesheet" href="@(ViewBag.UrlRoot)/Bootstrap/plugins/iCheck/square/green.css" />
    <!-- Date Picker
    <link rel="stylesheet" href="@(ViewBag.UrlRoot)/Bootstrap/plugins/datepicker/datepicker3.css" />-->
    <!-- Daterange picker
    <link rel="stylesheet" href="@(ViewBag.UrlRoot)/Bootstrap/plugins/daterangepicker/daterangepicker-bs3.css" />-->
    <!-- bootstrap wysihtml5 - text editor
    <link rel="stylesheet" href="@(ViewBag.UrlRoot)/Bootstrap/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" />-->
    <!-- Google Font: Source Sans Pro
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet" /> -->
    <style>
        .megamenu-li {
            position: static;
        }

        .megamenu {
            position: absolute;
            width: 100%;
            left: 0;
            right: 0;
            padding: 15px;
            padding-left: 0;
        }
        
        .hideoverflowbar {
            overflow: hidden;
        }
        .fa-spin {
            -webkit-animation: fa-spin 0.75s infinite linear;
            animation: fa-spin 0.75s infinite linear;
        }
        .menu-maingroup:hover > ul > li, .menu-maingroup:hover > ul > li > ul > li {
            /*display: block;
            opacity: 1;*/
            /*opacity: 1;
            height: auto;*/
            height: auto;
            opacity: 1;
            transition: height 0ms 0ms, opacity 600ms 0ms;
        }
        .li-menu {
            list-style-type: none;
        }
        .li-menu-hide {
            /*display: none;
            opacity: 0;*/
            /*transition: opacity 1s ease-out;
            opacity: 0;
            height: 0;
            overflow: hidden;*/
            overflow: hidden; /* Hide the element content, while height = 0 */
            height: 0;
            opacity: 0;
            transition: height 0ms 400ms, opacity 400ms 0ms;
        }
        .i-menu {
            margin-right: 4px;
        }
    </style>
</head>
<body class="hold-transition sidebar-mini sidebar-collapse">
    <div class="wrapper">
        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#"><i class="fa fa-bars"></i></a>
                </li>
            </ul>
            @helper DisplayMenu(AppProgram appC, int Ctr)
            {
                <ul>
                    @{
                        var appC2Coll = ((AppProgramCollection)ViewBag.AppPrograms)
                                                .Where(x => x.ParentProgramID == appC.ProgramID)
                                                .OrderBy(x => x.RowIndex);
                        var ii = 0;
                        foreach (AppProgram appC2 in appC2Coll)
                        {
                            <li class="li-menu @(Ctr == 1 ? "li-menu-hide":"")">
                                @if (appC2.IsParentProgram ?? false)
                                {
                                    <span class="dropdown-item"><i class="@appC2.AssemblyClassName i-menu"></i>@(appC2.ProgramName)</span>
                                    @DisplayMenu(appC2, Ctr + 1);
                                }
                                else
                                {
                                    <a class="dropdown-item" href="@appC2.NavigateUrl.Replace("~", @ViewBag.UrlRoot)"><i class="@appC2.AssemblyClassName i-menu"></i>@(appC2.ProgramName)</a>
                                }
                            </li>
                            ii++;
                        }
                    }
                </ul>
            }
            @helper DisplayMenuNoGroup(List<AppProgram> lAppPrg)
            {
                if (lAppPrg.Where(x => !x.es.IsDeleted).Any())
                {
                    <div class="col-sm-6 col-lg-3">
                        @{ 

                            var aApp = lAppPrg.Where(x => !x.es.IsDeleted).ToArray();
                            for (int i = 0; i < aApp.Count() && i < 4; i++)
                            {
                                <a class="dropdown-item" href="@aApp[i].NavigateUrl.Replace("~", @ViewBag.UrlRoot)"><i class="@aApp[i].AssemblyClassName i-menu"></i>@(aApp[i].ProgramName)</a>
                                aApp[i].MarkAsDeleted();
                            }
                        }
                    </div>
                    @DisplayMenuNoGroup(lAppPrg);
                }
            }

            <!-- Right navbar links -->
            <ul class="navbar-nav mr-auto">
                @foreach (AppProgram app in ((AppProgramCollection)ViewBag.AppPrograms)
.Where(x => string.IsNullOrEmpty(x.ParentProgramID))
.OrderBy(x => x.RowIndex))
                {
                    <li class="nav-item dropdown megamenu-li">
                        <a class="nav-link text-lg" href="#" id="dropdown@(app.ProgramID.Replace(".", "_"))"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="@app.AssemblyClassName i-menu" data-toggle="tooltip" data-placement="bottom" title="@(app.ProgramName)"></i>
                            <span>@(string.IsNullOrEmpty(app.AssemblyClassName) ? app.ProgramName:"")</span>
                        </a>
                        <div class="dropdown-menu megamenu" aria-labelledby="dropdown@(app.ProgramID.Replace(".", "_"))">
                            <div class="row">
                                <div class="col-12 text-right">
                                    <span class="text-xs text-primary">* contains more menu</span>
                                </div>
                                @{
                                    List<AppProgram> lMenu = new List<AppProgram>();
                                }
                                @foreach (AppProgram appChld in ((AppProgramCollection)ViewBag.AppPrograms)
                                    .Where(x => x.ParentProgramID == app.ProgramID)
                                    .OrderBy(x => x.RowIndex))
                                {

                                    if (appChld.IsParentProgram ?? false)
                                    {
                                        // render menu yang gak ada group besar
                                        if (lMenu.Count > 0)
                                        {
                                            @DisplayMenuNoGroup(lMenu);
                                        }

                                        <div class="col-sm-6 col-lg-3 menu-maingroup">
                                            @{
                                                var i = 0;
                                                var appChld2Coll = ((AppProgramCollection)ViewBag.AppPrograms)
                                                .Where(x => x.ParentProgramID == appChld.ProgramID)
                                                .OrderBy(x => x.RowIndex);
                                            }
                                            <h5 class="dropdown-item border border-top-0 border-right-0 border-left-0 text-primary"><i class="@appChld.AssemblyClassName i-menu"></i>@(appChld.ProgramName) @(appChld2Coll.Count() > 4 ? " *":"")</h5>
                                            <ul>
                                                @foreach (AppProgram appChld2 in appChld2Coll)
                                                {
                                                    <li class="li-menu @((i > 3 && appChld2Coll.Count() > 4) ? "li-menu-hide":"") ">
                                                        @if (appChld2.IsParentProgram ?? false)
                                                        {
                                                            <span class="dropdown-item text-info"><i class="@appChld2.AssemblyClassName i-menu"></i>@(appChld2.ProgramName)</span>
                                                            @DisplayMenu(appChld2, 1);
                                                        }
                                                        else
                                                        {
                                                            <a class="dropdown-item" href="@appChld2.NavigateUrl.Replace("~",@ViewBag.UrlRoot)"><i class="@appChld2.AssemblyClassName i-menu"></i>@(appChld2.ProgramName)</a>
                                                        }
                                                    </li>

                                                    i++;
                                                }
                                            </ul>
                                        </div>
                                    }
                                    else
                                    {
                                        lMenu.Add(appChld);
                                    }
                                }
                                @if (lMenu.Count > 0) // render menu yang gak ada group besar
                                {
                                    @DisplayMenuNoGroup(lMenu);
                                }
                            </div>
                        </div>
                    </li>
                }
            </ul>
            <!-- Right navbar links -->
            <ul class="navbar-nav ml-auto">
                <!-- Notifications Dropdown Menu -->
                @*<li class="nav-item dropdown">
                <a class="nav-link" data-toggle="dropdown" href="#">
                    <i class="far fa-bell"></i>
                    <span class="badge badge-warning navbar-badge">15</span>
                </a>
                <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                    <span class="dropdown-item dropdown-header">15 Notifications</span>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item">
                        <i class="fas fa-envelope mr-2"></i> 4 new messages
                        <span class="float-right text-muted text-sm">3 mins</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item">
                        <i class="fas fa-users mr-2"></i> 8 friend requests
                        <span class="float-right text-muted text-sm">12 hours</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item">
                        <i class="fas fa-file mr-2"></i> 3 new reports
                        <span class="float-right text-muted text-sm">2 days</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item dropdown-footer">See All Notifications</a>
                </div>
            </li>*@
            </ul>
            <!-- Right navbar links -->
        </nav>
        <!-- /.navbar -->
        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-warning elevation-4 hideoverflowbar">
            <!-- Brand Logo -->
            <a href="javascript:void(0);" onclick="javascript: backToHomepage();" class="brand-link">
                <img src="@(ViewBag.UrlRoot)/Images/LogoRS.jpg" alt="Logo" class="brand-image elevation-3"
                     style="opacity: .8">
                <div>
                    <span class="brand-text font-weight-light">@ViewData["AppParam_HealthcareInitial"]</span>
                </div>
            </a>
            <!-- Sidebar -->
            <div class="sidebar hideoverflowbar">
                <div class="info mt-3 pb-3 mb-3">
                    <div style="width:230px;">
                        <a>
                            <p>
                                <span class="brand-text font-weight-light">
                                    @ViewData["Healthcare_HealthcareName"]
                                </span>
                            </p>
                            <span class="brand-text font-weight-light d-none">
                                @ViewData["Healthcare_Address"]
                            </span>
                        </a>
                    </div>
                </div>
                <div id="navLeftMain">
                    <nav class="mt-2">
                        <ul id="ulMenuLeft" class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                            <!-- Add icons to the links using the .nav-icon class with font-awesome or any other icon font library -->
                            <li class="nav-item has-treeview">
                                <a href="#" class="nav-link">
                                    <i class="nav-icon fas fa-laptop-code"></i>
                                    <p>
                                        Application Control
                                        <i class="right fas fa-angle-left"></i>
                                    </p>
                                </a>
                                <ul id="ulMenuLeftItem" class="nav nav-treeview">
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" onclick="javascript:logoutClick();" class="nav-link">
                                            <i class="fa fa-power-off nav-icon text-danger"></i>
                                            <p>Log Out</p>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" onclick="javascript: backToHomepage();" class="nav-link">
                                            <i class="fas fa-home nav-icon text-primary"></i>
                                            <p>Go To Homepage</p>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" onclick="javascript:backToMainApp();" class="nav-link">
                                            <i class="fa fa-desktop nav-icon text-primary"></i>
                                            <p>Go To Main App</p>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            @RenderSection("LeftMenu", required: false)
                        </ul>
                    </nav>
                </div>
                <div id="navLeftCustom">

                </div>
                <!-- Sidebar Menu -->
            </div>
            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <!-- /.content-header -->
            <!-- Main content -->
            <section class="content px-1 py-0">
                <div class="container-fluid">
                    <!-- Main row -->
                    @RenderBody()
                    <!-- /.row -->
                </div>
                <!-- /.container-fluid -->
            </section>
            <!-- /.content -->
        </div>
        <!-- /.content-wrapper -->
        <footer class="main-footer">
            <strong><a href="@ViewBag.Brand.Website">@ViewBag.Brand.VendorName</a>.</strong>
            <div class="float-right d-none d-sm-inline-block">
                <b>Version</b> 1.0.0
            </div>
        </footer>

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
            bla bla bal
            bal
        </aside>
        <!-- /.control-sidebar -->
    </div>
    <!-- ./wrapper -->
    <!-- jQuery -->
    <script src="@(ViewBag.UrlRoot)/Bootstrap/plugins/jquery/jquery.min.js"></script>
    <!-- jQuery UI 1.11.4 -->
    <script src="@(ViewBag.UrlRoot)/Bootstrap/plugins/jquery-ui/jquery-ui.min.js"></script>
    <!-- <script src="@(ViewBag.UrlRoot)/Bootstrap/plugins/jQueryUI/jquery-migrate-3.0.0.min.js"></script>  -->
    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
    <script>
        $.widget.bridge('uibutton', $.ui.button)
    </script>
    <!-- Bootstrap 4 -->
    <script src="@(ViewBag.UrlRoot)/Bootstrap/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- Sparkline
    <script src="@(ViewBag.UrlRoot)/Bootstrap/plugins/sparkline/jquery.sparkline.min.js"></script>-->
    <!-- daterangepicker
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>
    <script src="@(ViewBag.UrlRoot)/Bootstrap/plugins/daterangepicker/daterangepicker.js"></script>-->
    <!-- datepicker
    <script src="@(ViewBag.UrlRoot)/Bootstrap/plugins/datepicker/bootstrap-datepicker.js"></script>-->
    <!-- Bootstrap WYSIHTML5
    <script src="@(ViewBag.UrlRoot)/Bootstrap/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>-->
    <!-- Slimscroll
    <script src="@(ViewBag.UrlRoot)/Bootstrap/plugins/slimScroll/jquery.slimscroll.min.js"></script>-->
    <!-- FastClick
    <script src="@(ViewBag.UrlRoot)/Bootstrap/plugins/fastclick/fastclick.js"></script>-->
    <!-- AdminLTE App -->
    <script src="@(ViewBag.UrlRoot)/Bootstrap/adminlte/js/adminlte.js"></script>
    <!-- AdminLTE dashboard demo (This is only for demo purposes)
    <script src="@(ViewBag.UrlRoot)/Bootstrap/adminlte/js/pages/dashboard.js"></script> -->
    <!-- iCheck -->
    <script src="@(ViewBag.UrlRoot)/Bootstrap/plugins/iCheck/icheck.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="@(ViewBag.UrlRoot)/Bootstrap/adminlte/js/demo.js"></script>

    <script src="@(ViewBag.UrlRoot)/Bootstrap/js/settings.js"></script>
    <script src="@(ViewBag.UrlRoot)/Bootstrap/js/core.js"></script>
    <script src="@(ViewBag.UrlRoot)/Bootstrap/js/tic.js"></script>

    <script language="javascript">
        //$ = $telerik.$;
        var BaseURL = '@ViewBag.UrlRoot';

        function TestAlert() {
            alert("test");
        }
        function logoutClick() {
            window.location = BaseURL + '/Home/Logout';
        }
        function backToLogin() {
            window.location = BaseURL + '/Home/Login';
        }
        function backToHomepage() {
            window.location = BaseURL + '/Home';
        }
        function backToMainApp() {
            window.location = BaseURL + '/Default.aspx';
        }

        //function SetHtml(controlName, title) {
        //    //$('#' + controlName).animate({ 'opacity': 0 }, 400, function () {
        //    //    $(this).html(title).animate({ 'opacity': 1 }, 400);
        //    //});
        //    //$('#' + controlName).html(title);
        //    $('#' + controlName).hide();
        //    $('#' + controlName).html(title).fadeIn('slow');
        //}
        //function NavLeftClear() {
        //    $('#navLeftCustom').html('');
        //}
        //function NavLeftSetSelected(Sender) {
        //    $('#navLeftCustom .nav-link').each(function () {
        //        $(this).removeClass("active");
        //    });
        //    $(Sender).addClass("active");
        //}
        //function NavLeftAddItem(GroupID, Text, JsFN, iconClass) {
        //    $('#' + GroupID +'Item').append('<li class="nav-item"><a href="javascript:void(0);" onclick="javascript:' + JsFN +
        //        ';" class="nav-link"><i class="nav-icon ' + iconClass +
        //        '"></i><p>' + Text + '</p></a></li>');
        //}
        //function NavLeftAddGroup(GroupID, GroupText, iconClass) {
        //    $('#navLeftCustom').append(
        //        '<nav class="mt-2">' +
        //        ' <ul id="' + GroupID + '" class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">' +
        //        '  <li class="nav-item has-treeview menu-open">' +
        //        '   <a href="#" class="nav-link">' +
        //        '    <i class="nav-icon ' + iconClass + '"></i>' +
        //        '    <p>' + GroupText +'<i class="right fas fa-angle-left"></i></p>' +
        //        '   </a>' +
        //        '   <ul id="' + GroupID + 'Item" class="nav nav-treeview">' +
        //        '   </ul>' +
        //        '  </li>' +
        //        ' </ul>' +
        //        '</nav>'
        //    );
        //}

        $(document).ready(function () {
            $.ajaxSetup({
                beforeSend: function (xhr) {
                    if (xhr.overrideMimeType) {
                        xhr.overrideMimeType("application/json");
                    }
                }
            });

            var argsSession = [];
            var jSonFnTicSession = { fn: NotifGetSession, args: argsSession, tic: 30000 };
            _FNTOEXEC.push(jSonFnTicSession);

            $(".megamenu").on("click", function (e) {
                e.stopPropagation();
            });

            $('[data-toggle="tooltip"]').tooltip();
        });

        /* belum dipake
        $(document).on('shown.lte.pushmenu', function () {
            alert("shown");
        });
        $(document).on('collapsed.lte.pushmenu', function () {
            alert("collapsed");
        });
        */

        var _bFnNotifGetSession = false;
        function NotifGetSession() {
            // we have to suspend another request before prev request is completed vrohh..!!
            if (_bFnNotifGetSession)
                return;
            _bFnNotifGetSession = true;

            //console.log("1");

            $.ajax({
                type: 'POST',
                url: BaseURL + "/WebService/jQueryWS.asmx/NPCNotifGetSession",
                success: function (data) {
                    // do something
                    if (data.status == _sJsonRequestOkStatus) {
                        _bFnNotifGetSession = false;
                    } else {
                        var dlg = ShowError(data.data);
                        dlg.find('.modal-footer').find('button').click(function () {
                            backToLogin();
                        });
                        _bFnNotifGetSession = false;
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    ShowError(xhr.responseText);
                    _bFnNotifGetSession = false;
                },
                dataType: 'json'
            });
        }

    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>
